{
  "hash": "15884872abadb7fa2d03b358392504e1",
  "result": {
    "markdown": "---\ntitle: Diagramas de volcán\nlang: es\n---\n\n\n\n\nUn diagrama de volcán es una representación gráfica utilizada en Bioinformática para visualizar los resultados del análisis de expresión génica diferencial u otros tipos de análisis de datos ómicos de alto rendimiento, como Proteómica o Metabolómica.\n\nEn un diagrama de volcán, cada punto de datos representa un gen (o una proteína/metabolito) del conjunto de datos. El eje x muestra el cambio logarítmico o tamaño del efecto, que mide la magnitud del cambio en la expresión entre dos condiciones (por ejemplo, tratamiento vs. control). El eje y muestra la significación estadística, a menudo representada como el logaritmo negativo del valor p. Un valor p más pequeño indica una mayor significación estadística.\n\nA menudo, los puntos en el gráfico de volcán están coloreados o resaltados según su significación estadística y cambio en la expresión. Por lo general, los genes significativamente sobreexpresados se representan en rojo, los genes significativamente subexpresados en azul y los genes no significativamente expresados en gris o negro. Cuanto más significativos sean estadísticamente y mayor sea el cambio en la expresión, más alejados estarán los puntos del centro del gráfico.\n\nEl nombre del del diagrama proviene de su forma característica, donde los genes significativos con grandes cambios en la expresión se representan como puntos alejados del centro, asemejándose a las laderas de un volcán. Mientras tanto, los genes no significativos se agrupan cerca del centro, formando la caldera del volcán.\n\nLos investigadores utilizan gráficos de volcán para identificar rápidamente genes o proteínas con cambios sustanciales en la expresión entre condiciones y, al mismo tiempo, considerar su significación estadística. Esta visualización ayuda a identificar posibles biomarcadores, genes diferencialmente expresados o vías biológicas relevantes asociadas con condiciones o tratamientos específicos.\n\nEn esta sección veremos con construir un diagrama de volcán con R.\n\n::: callout-note\n## Datos\n\nUtilizaremos los datos del estudio [Fu et al. Nat Cell Biol. 2015](https://pubmed.ncbi.nlm.nih.gov/25730472/), que contienen los resultados del análisis de expresión génica diferencial (logaritmo en base 2 de la razón de cambio y p-valor) de un estudio para comparar dos grupos experimentales.\n:::\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Carga de datos\ndf <- read_csv(\"datos/datos-volcan.csv\")\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  ENTREZID SYMBOL  GENENAME               logFC AveExpr     t  P.Value adj.P.Val\n     <dbl> <chr>   <chr>                  <dbl>   <dbl> <dbl>    <dbl>     <dbl>\n1    12992 Csn1s2b casein alpha s2-like B -8.60   3.56  -43.8 3.83e-15  6.05e-11\n2    13358 Slc25a1 solute carrier family… -4.12   5.78  -29.9 1.76e-13  1.39e- 9\n3    11941 Atp2b2  ATPase, Ca++ transpor… -7.39   1.28  -27.8 4.84e-13  2.43e- 9\n4    20531 Slc34a2 solute carrier family… -4.18   4.28  -27.1 6.16e-13  2.43e- 9\n5   100705 Acacb   acetyl-Coenzyme A car… -4.31   4.44  -25.2 1.50e-12  4.74e- 9\n6    13645 Egf     epidermal growth fact… -5.36   0.736 -24.6 2.12e-12  5.57e- 9\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creación del diagrama de volcán\nvplot <- df %>%\n  ggplot(aes(x = logFC, y = -log10(adj.P.Val))) + \n  geom_point(color = \"grey40\")\nvplot\n```\n\n::: {.cell-output-display}\n![](diagrama-volcan_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\nPara diferenciar los genes con mayor expresión diferencial, es decir, con mayor razón de cambio, se suelen añadir dos rectas verticales. La recta más a la izquierda representa el logaritmo en base 2 de la máxima razón de cambio para considerar un gen subexpresado (suele tomarse una razón de cambio 1/2, es decir, el gen en el grupo experimental se expresa la mitad que en el grupo control), mientras que la recta de la derecha representa el logaritmo en base 2 de la mínima razón de cambio para considerar un gen sobreexpresado (suele tomarse una razón de cambio 2, es decir, el gen en el grupo experimental se expresa el doble que en el grupo control).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Determinamos las coordenadas mínimas y máximas para las escalas de los ejes.\nrangex <- max(-min(df$logFC), max(df$logFC))\nmaxy <- max(-log10(df$adj.P.Val))\n# Dibujo de líneas verticales para el tamaño del efecto\nvplot <- vplot + geom_vline(xintercept = c(log2(0.5), log2(2)),linetype = \"dashed\") +\n  # Etiquetamos las líneas de la razón de cambio.\n  annotate(\"text\", x = log2(0.5), y = maxy, label = \"FC=1/2\", vjust = 0) +\n  annotate(\"text\", x = log2(2), y = maxy, label = \"FC=2\", vjust = 0) +\n  theme(plot.margin = unit(c(3, 4, 1, 1), \"lines\")) +\n  coord_cartesian(xlim = c(-rangex, rangex), ylim = c(0, maxy), expand = FALSE, clip = \"off\") \nvplot\n```\n\n::: {.cell-output-display}\n![](diagrama-volcan_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nDel mismo modo, se suelen dibujar líneas verticales para identificar los genes con una expresión diferencial estadísticamente significativa (p-valor menor que 0.05 o 0.01).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvplot <- vplot +\n  geom_hline(yintercept = c(-log10(0.05), -log10(0.01)), linetype = \"dashed\") +\n  # Etiquetamos las líneas de los p-valores\n  annotate(\"text\", x = 10.2, y = -log10(0.05), label = \"p=0.05\", hjust = 0) +\n  annotate(\"text\", x = 10.2, y = -log10(0.01), label = \"p=0.01\", hjust = 0) \nvplot\n```\n\n::: {.cell-output-display}\n![](diagrama-volcan_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nPara destacar los genes con mayor expresión diferencial y mayor significación estadística, es habitual dibujarlos con un color diferenciado (típicamente azul para los subexpresados y rojo para los sobre expresados). Para ello, previamente hay que crear una nueva columna en el conjunto de datos con las categorías categorías de expresión(normalmente \"Down\" para los genes subexpresados significativamente, \"NS\" para los genes que no cambian y \"Up\" para los genes sobreexpresados significativamente)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crear nueva columna con categorías de expresión génica.\ndf <- df |>\n    mutate(Expresión = case_when(\n        logFC >= log2(2) & adj.P.Val <= 0.05 ~ \"Up\", \n        logFC <= log2(0.5) & adj.P.Val <= 0.05 ~ \"Down\",\n        TRUE ~ \"NC\"))\n# Mostrar tabla con frecuencias de genes subexpresados y sobreexpresados\ndf  |> \n    count(Expresión)  |> \n    gt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"ifwsuoyamv\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ifwsuoyamv table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ifwsuoyamv thead, #ifwsuoyamv tbody, #ifwsuoyamv tfoot, #ifwsuoyamv tr, #ifwsuoyamv td, #ifwsuoyamv th {\n  border-style: none;\n}\n\n#ifwsuoyamv p {\n  margin: 0;\n  padding: 0;\n}\n\n#ifwsuoyamv .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ifwsuoyamv .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ifwsuoyamv .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ifwsuoyamv .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ifwsuoyamv .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ifwsuoyamv .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ifwsuoyamv .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ifwsuoyamv .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ifwsuoyamv .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ifwsuoyamv .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ifwsuoyamv .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ifwsuoyamv .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ifwsuoyamv .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ifwsuoyamv .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ifwsuoyamv .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ifwsuoyamv .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ifwsuoyamv .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ifwsuoyamv .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ifwsuoyamv .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ifwsuoyamv .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ifwsuoyamv .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ifwsuoyamv .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ifwsuoyamv .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ifwsuoyamv .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ifwsuoyamv .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ifwsuoyamv .gt_left {\n  text-align: left;\n}\n\n#ifwsuoyamv .gt_center {\n  text-align: center;\n}\n\n#ifwsuoyamv .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ifwsuoyamv .gt_font_normal {\n  font-weight: normal;\n}\n\n#ifwsuoyamv .gt_font_bold {\n  font-weight: bold;\n}\n\n#ifwsuoyamv .gt_font_italic {\n  font-style: italic;\n}\n\n#ifwsuoyamv .gt_super {\n  font-size: 65%;\n}\n\n#ifwsuoyamv .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ifwsuoyamv .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ifwsuoyamv .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ifwsuoyamv .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ifwsuoyamv .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ifwsuoyamv .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ifwsuoyamv .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Expresión\">Expresión</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"n\">n</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Expresión\" class=\"gt_row gt_left\">Down</td>\n<td headers=\"n\" class=\"gt_row gt_right\">1245</td></tr>\n    <tr><td headers=\"Expresión\" class=\"gt_row gt_left\">NC</td>\n<td headers=\"n\" class=\"gt_row gt_right\">13578</td></tr>\n    <tr><td headers=\"Expresión\" class=\"gt_row gt_left\">Up</td>\n<td headers=\"n\" class=\"gt_row gt_right\">981</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Definimos los colores para los genes subexpresados, normales y sobreexpresados.\ncolores <- c(\"dodgerblue3\", \"gray50\", \"firebrick3\")\nvplot <- df %>%\n  ggplot(aes(x = logFC, y = -log10(adj.P.Val))) + \n  geom_point(aes(color = Expresión)) +\n  scale_color_manual(values = colores) +\n  # Añadimos las líneas de la razón de cambio.\n  geom_vline(xintercept = c(log2(0.5), log2(2)),linetype = \"dashed\") +\n  # Etiquetamos las líneas de la razón de cambio.\n  annotate(\"text\", x = log2(0.5), y = maxy, label = \"FC=1/2\", vjust = 0) +\n  annotate(\"text\", x = log2(2), y = maxy, label = \"FC=2\", vjust = 0) +\n  # Añadimos las líneas de los p-valores.\n  geom_hline(yintercept = c(-log10(0.05), -log10(0.01)), linetype = \"dashed\") +\n  # Etiquetamos las líneas de los p-valores.\n  annotate(\"text\", x = rangex+0.1, y = -log10(0.05), label = \"p=0.05\", hjust = 0) +\n  annotate(\"text\", x = rangex+0.1, y = -log10(0.01), label = \"p=0.01\", hjust = 0) +\n  theme(plot.margin = unit(c(2, 1, 1, 1), \"lines\")) +\n  coord_cartesian(xlim = c(-rangex, rangex), ylim = c(0, maxy), expand = FALSE, clip = \"off\")\nvplot\n```\n\n::: {.cell-output-display}\n![](diagrama-volcan_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nTambién se pueden destacar algunos genes de interés en el gráfico mediante etiquetas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creamos un nuevo conjunto de datos con los genes a destacar\ndf_sig <- df  |> \n  filter(SYMBOL %in% c(\"Il15\", \"Il34\", \"Il24\"))\n\n# df_pvalor <- data.frame(x)\n\nvplot <- vplot +  \n  # Etiquetamos los genes a destacar\n  geom_label_repel(data = df_sig, aes(label = SYMBOL), force = 2, nudge_y = 1) \nvplot\n```\n\n::: {.cell-output-display}\n![](diagrama-volcan_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nFinalmente, añadimos un título al diagrama.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvplot +\n  labs(title = \"Diagrama de volcán\") +\n  theme(plot.title = element_text(margin=margin(0,0,25,0)))\n```\n\n::: {.cell-output-display}\n![](diagrama-volcan_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}